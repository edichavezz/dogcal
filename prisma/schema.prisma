generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(uuid())
  name               String
  addressText        String?
  role               UserRole
  createdAt          DateTime            @default(now())
  profilePhotoUrl    String?
  calendarColor      String?
  phoneNumber        String?
  address            String?
  loginToken         String?             @unique
  assignedHangouts   Hangout[]           @relation("HangoutAssignedFriend")
  createdHangouts    Hangout[]           @relation("HangoutCreator")
  hangoutNotes       HangoutNote[]
  hangoutResponses   HangoutResponse[]
  meetupRsvps        MeetupRSVP[]
  ownerDecisions     HangoutSuggestion[] @relation("SuggestionOwnerDecision")
  hangoutSuggestions HangoutSuggestion[] @relation("SuggestionFriend")
  ownedPups          Pup[]               @relation("PupOwner")
  pupFriendships     PupFriendship[]     @relation("FriendUser")
}

model Pup {
  id               String              @id @default(uuid())
  name             String
  ownerUserId      String
  careInstructions String?
  createdAt        DateTime            @default(now())
  profilePhotoUrl  String?
  breed            String?
  // FAQ fields for structured pup care info
  about            String?             // About the pup (personality, background)
  food             String?             // Amounts, times, how to prep, toppings
  treats           String?             // Conditions for giving treats, what's allowed
  walks            String?             // Frequency, length, off/on-lead preferences
  leash            String?             // Heel vs push, crossing road, on/off behavior
  socialising      String?             // Other dogs, children, new people, special notes
  tricks           String?             // Known tricks, training preferences
  play             String?             // Toys, games, entertainment
  hangouts         Hangout[]
  suggestions      HangoutSuggestion[]
  photos           PupPhoto[]
  owner            User                @relation("PupOwner", fields: [ownerUserId], references: [id], onDelete: Cascade)
  friendships      PupFriendship[]

  @@index([ownerUserId])
}

model PupPhoto {
  id        String   @id @default(uuid())
  pupId     String
  photoUrl  String
  caption   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  pup       Pup      @relation(fields: [pupId], references: [id], onDelete: Cascade)

  @@index([pupId])
}

model PupFriendship {
  id             String   @id @default(uuid())
  pupId          String
  friendUserId   String
  historyWithPup String?
  createdAt      DateTime @default(now())
  friend         User     @relation("FriendUser", fields: [friendUserId], references: [id], onDelete: Cascade)
  pup            Pup      @relation(fields: [pupId], references: [id], onDelete: Cascade)

  @@unique([pupId, friendUserId])
  @@index([pupId])
  @@index([friendUserId])
}

model Hangout {
  id                   String        @id @default(uuid())
  pupId                String
  startAt              DateTime
  endAt                DateTime
  status               HangoutStatus @default(OPEN)
  assignedFriendUserId String?
  createdByOwnerUserId String
  ownerNotes           String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  eventName            String?
  seriesId             String?
  seriesIndex          Int?
  assignedFriend       User?         @relation("HangoutAssignedFriend", fields: [assignedFriendUserId], references: [id])
  createdByOwner       User          @relation("HangoutCreator", fields: [createdByOwnerUserId], references: [id], onDelete: Cascade)
  pup                  Pup           @relation(fields: [pupId], references: [id], onDelete: Cascade)
  notes                HangoutNote[]
  responses            HangoutResponse[]

  @@index([pupId])
  @@index([status])
  @@index([assignedFriendUserId])
  @@index([pupId, status])
  @@index([startAt])
}

model HangoutNote {
  id           String   @id @default(uuid())
  hangoutId    String
  authorUserId String
  noteText     String
  createdAt    DateTime @default(now())
  author       User     @relation(fields: [authorUserId], references: [id], onDelete: Cascade)
  hangout      Hangout  @relation(fields: [hangoutId], references: [id], onDelete: Cascade)

  @@index([hangoutId])
}

model HangoutResponse {
  id              String                @id @default(uuid())
  hangoutId       String
  responderUserId String
  status          HangoutResponseStatus
  respondedAt     DateTime              @default(now())
  hangout         Hangout               @relation(fields: [hangoutId], references: [id], onDelete: Cascade)
  responder       User                  @relation(fields: [responderUserId], references: [id], onDelete: Cascade)

  @@unique([hangoutId, responderUserId])
  @@index([hangoutId])
  @@index([responderUserId])
}

model HangoutSuggestion {
  id                      String           @id @default(uuid())
  pupId                   String
  suggestedByFriendUserId String
  startAt                 DateTime
  endAt                   DateTime
  status                  SuggestionStatus @default(PENDING)
  friendComment           String?
  ownerComment            String?
  ownerDecisionByUserId   String?
  ownerDecisionAt         DateTime?
  createdAt               DateTime         @default(now())
  eventName               String?
  seriesId                String?
  seriesIndex             Int?
  ownerDecisionBy         User?            @relation("SuggestionOwnerDecision", fields: [ownerDecisionByUserId], references: [id])
  pup                     Pup              @relation(fields: [pupId], references: [id], onDelete: Cascade)
  suggestedByFriend       User             @relation("SuggestionFriend", fields: [suggestedByFriendUserId], references: [id], onDelete: Cascade)

  @@index([pupId])
  @@index([status])
  @@index([pupId, status])
}

model CommunityMeetup {
  id        String        @id @default(uuid())
  startAt   DateTime
  endAt     DateTime
  location  String
  notes     String?
  createdAt DateTime      @default(now())
  rsvps     MeetupRSVP[]

  @@index([startAt])
}

model MeetupRSVP {
  id        String          @id @default(uuid())
  meetupId  String
  userId    String
  createdAt DateTime        @default(now())
  meetup    CommunityMeetup @relation(fields: [meetupId], references: [id], onDelete: Cascade)
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([meetupId, userId])
  @@index([meetupId])
  @@index([userId])
}

enum UserRole {
  OWNER
  FRIEND
}

enum HangoutStatus {
  OPEN
  ASSIGNED
  COMPLETED
  CANCELLED
}

enum HangoutResponseStatus {
  YES
  NO
}

enum SuggestionStatus {
  PENDING
  APPROVED
  REJECTED
}
